!function(e){function t(t){for(var r,a,c=t[0],u=t[1],f=t[2],s=0,p=[];s<c.length;s++)a=c[s],o[a]&&p.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,f||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={13:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/dist/";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var f=0;f<c.length;f++)t(c[f]);var l=u;i.push([100,0]),n()}({100:function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=n(1),i=n(7),a=n(6).promisify,c=n(0),u=n(4).js,f=n(17).encode,l=n(19),s=n(101),p=n(102),d=n(106),m=function(e){return e.replace(/\?.*/,"")},v="Operation";CloudCmd[v]=t;var h,g=CloudCmd,y=g.TITLE,C=g.config,O=DOM,b=O.Dialog,M=O.Images,x=i(function(e,t,n){t="".concat(t,"/fileop"),fileop({prefix:e,socketPrefix:t},function(e,t){n(),t.on("connect",D(t,A)),t.on("disconnect",_)})}),D=i(function(e,t){var n=i(t),r=i(b.alert);e.on("accept",n(e)),e.on("reject",r(y,"Wrong credentials!")),e.emit("auth",C("username"),C("password"))}),k={},w=l.cp,P=l.mv,F=l.delete,S=l.extract,j=l.pack,N=l.pack,z=DOM.CurrentInfo,E=M.show.load.bind(null,"top"),I=o(function(e,t){var n,o,i,a="",c="",u=[];t?(a=t.from,c=t.to,u=t.names,o=z.panel):(a=z.dirPath,c=DOM.getNotCurrentDirPath(),n=DOM.getSelectedFiles(),u=DOM.getFilenames(n),t={},i=!0,o=z.panelPassive);u.length||u.push(DOM.getCurrentName());var l=r(u,1)[0],s=DOM.getCurrentByName(l,o);if(!t&&T())return;var p="copy"===e.type,d=p?"confirmCopy":"confirmMove",m=p?"Copy":"Rename/Move",v=p?w:P;if(i&&C(d))return function(e,t,n){var o=n.length,i=r(n,1)[0];e+=" ",n.length>1?e+=o+" file(s)":e+='"'+i+'"';e+=" to";return b.prompt(y,e,t,{cancel:!1})}(m,c,u.map(f)).then(h);function h(e){if(a!==e&&e&&!i||!s)return r();var n='"'.concat(l,'" already exist. Overwrite?');function r(){E(),v({from:a,to:e,names:u},function(){DOM.Storage.remove(a,function(){var e=z.panel,n=z.panelPassive;z.isOnePanel||CloudCmd.refresh({panel:n,noCurrent:!0}),CloudCmd.refresh({panel:e},function(){var e=l||t.names[0];DOM.setCurrentByName(e)})})})}b.confirm(y,n,{cancel:!1}).then(r)}h(c)}),T=function(){var e=DOM.getActiveFiles().length,t=Boolean(!e);return t?b.alert.noFiles(y):t};function A(e){N=function(t,n){var r=t.from,o=t.to,i=t.names,a=p({operation:"Tar",callback:n,noContinue:!0,from:r,to:o});e.tar(r,o,i).then(a)},j=function(t,n){var r=t.from,o=t.to,i=t.names,a=p({operation:"Zip",callback:n,noContinue:!0,from:r,to:o});e.zip(r,o,i).then(a)},F=function(t,n,r){t=m(t);var o=p({operation:"Delete",callback:r,from:t});e.remove(t,n).then(o)},w=function(t,n){var r=t.from,o=t.to,i=t.names,a=p({operation:"Copy",callback:n,from:r,to:o,names:i});e.copy(r,o,i).then(a)},P=function(t,n){var r=t.from,o=t.to,i=t.names,a=p({operation:"Move",callback:n,from:r,to:o});e.move(r,o,i).then(a)},S=function(t,n){var r=t.from,o=t.to,i=p({operation:"Extract",callback:n,noContinue:!0,from:r,to:o});e.extract(r,o).then(i)}}function _(){j=l.pack,N=l.pack,F=l.delete,w=l.cp,P=l.mv,S=l.extract}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DOM.getActiveFiles(),t=z.dirPath;if(!T()){E();var n=DOM.getFilenames(e),r=DOM.CurrentInfo.files.map(DOM.getCurrentName),o=DOM.getCurrentName(),i=d(o,r,n);F(t+"?files",n,function(){CloudCmd.refresh(function(){var e=z.files.map(DOM.getCurrentName).includes(o)?o:i;DOM.setCurrentByName(e)})})}}function L(e,t){var n,r,o=z.name,i=z.path,a=z.dirPath,c=DOM.getActiveFiles(),u=DOM.getFilenames(c);if(function(e,t){if(!t)throw Error(e+" could not be empty!")}("operation",e),!u.length)return b.alert.noFiles(y);switch(e){case"extract":n=S,r={from:i,to:a},o=s(o);break;case"pack":n=function(e){return"zip"===e?j:N}(t),u.length>1&&(o=z.dir),r={from:a,to:a+(o+=DOM.getPackerExt(t)),names:u}}E(),n(r,function(e){!e&&CloudCmd.refresh({currentName:o})})}e.exports.init=a(function(e){E(),c.series([DOM.loadSocket,function(e){if(!C("progress")||C("dropbox"))return e();var t=CloudCmd,n=t.prefix,r=t.prefixSocket;!function(e){var t=CloudCmd.prefix,n="".concat(t,"/fileop/fileop.js");u(n,function(t){if(t)return b.alert(y,t.message),c(e);h=!0,Util.timeEnd(v+" load"),c(e)}),Util.time(v+" load")}(x(n,r,e))},function(e){h=!0,M.hide(),e()}],e)}),e.exports.hide=function(){CloudCmd.View.hide()},e.exports.show=function(e,t){if(h)return"copy"===e?k.copy(t):"move"===e?k.move(t):"delete"===e?k.delete():"delete:silent"===e?k.deleteSilent():"pack"===e?k.pack():"extract"===e?k.extract():void 0},k.copy=I({type:"copy"}),k.move=I({type:"move"}),k.delete=function(){!function(){if(T())return;var e,t="Do you really want to delete the ",n=DOM.getActiveFiles(),r=DOM.getFilenames(n),o=r.length;if(o){for(var i="",a=0;a<5&&a<o;a++)i+="\n"+r[a];o>=5&&(i+="\n..."),e=t+"selected "+o+" files/directories?\n"+f(i)}else{var c=DOM.getCurrentFile(),u=DOM.isCurrentIsDir(c),l=function(e){return e?"directory":"file"}(u)+" ",s=DOM.getCurrentName(c);e=t+"selected "+l+s+"?"}b.confirm(y,e,{cancel:!1}).then(function(){B(n)})}()},k.deleteSilent=function(){B()},k.pack=function(){L("pack","zip"===C("packer")?"zip":"tar")},k.extract=function(){L("extract")}},101:function(e,t,n){"use strict";var r=n(9).getExt;e.exports=function(e){var t=function(e){return/\.tar\.gz$/.test(e)?".tar.gz":/\.tar\.bz2$/.test(e)?".tar.bz2":r(e)}(e);return e.replace(t,"")}},102:function(e,t,n){"use strict";var r=n(29),o=DOM,i=o.Dialog,a=o.Images,c=n(103),u=n(7),f=CloudCmd.TITLE,l=n(105);e.exports=function(e){return function(t){var n,o,s=e.operation,p=e.callback,d=e.noContinue,m=e.from,v=e.to,h=u(function(e){var t=e.emitter,n=e.operation;t.abort();var r="".concat(n," aborted");o=!0,i.alert(f,r,{noCancel:!0})}),g=t.removeListener.bind(t),y=t.on.bind(t),C=l(s,m,v),O=r.progress(f,C);O.catch(h({emitter:t,operation:s}));var b={progress:function(e){n=100===e,O.setProgress(e)},end:function(){a.hide(),c(g,b),(o||n)&&p()},error:function(e){if(o=e,d)return b.end(e),void i.alert(f,e);i.confirm(f,e+"\n Continue?").then(function(){t.continue()},function(){t.abort()})}};c(y,b)}}},105:function(e,t,n){"use strict";e.exports=function(e,t,n){return n?"".concat(e," ").concat(t," -> ").concat(n):"".concat(e," ").concat(t)}},106:function(e,t,n){"use strict";var r=n(1),o=r(function(e,t){return!~e.indexOf(t)}),i=r(function(e,t){return e.filter(o(t))});e.exports=function(e,t,n){var r=t.indexOf(e),o=i(t,n),a=o.length;return o[r]?o[r]:o[a-1]}}});
//# sourceMappingURL=operation.js.map